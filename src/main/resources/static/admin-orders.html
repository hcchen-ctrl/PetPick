<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¨‚å–®ç®¡ç†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        .sidebar {
            min-height: 100vh;
        }

        .table thead th {
            white-space: nowrap;
        }

        .loading-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, .6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .toast-container {
            z-index: 2100;
        }

        .font-mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- å´é‚Šé¸å–® -->
            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="admin-dashboard.html">é¦–é </a></li>
                        <li class="nav-item"><a class="nav-link" href="admin-products.html">å•†å“ç®¡ç†</a></li>
                        <li class="nav-item"><a class="nav-link active" href="admin-orders.html">è¨‚å–®ç®¡ç†</a></li>
                        <li class="nav-item"><a class="nav-link" href="admin-users.html">æœƒå“¡ç®¡ç†</a></li>
                    </ul>
                </div>
            </nav>

            <!-- ä¸»å…§å®¹ -->
            <main class="col-md-10 ms-sm-auto px-md-4 mt-4">
                <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
                    <h2 class="m-0">ğŸ“‘ è¨‚å–®ç®¡ç†</h2>
                    <div class="text-muted small">
                        å…± <span id="orderCount">0</span> ç­†
                        <span class="ms-3">æœ€å¾Œæ›´æ–°ï¼š<span id="lastRefreshed">â€”</span></span>
                    </div>
                </div>

                <!-- ç¯©é¸åˆ— -->
                <div class="card mb-3">
                    <div class="card-body">
                        <form id="filterForm" class="row g-2 align-items-end">
                            <div class="col-12 col-md-3">
                                <label class="form-label">é—œéµå­—ï¼ˆè¨‚å–®/æœƒå“¡/é›»è©±ï¼‰</label>
                                <input type="text" class="form-control" id="qFilter" placeholder="ä¾‹å¦‚ï¼š#1024ã€ç‹å°æ˜ã€0912...">
                            </div>
                            <div class="col-6 col-md-2">
                                <label class="form-label">ç‹€æ…‹</label>
                                <select class="form-select" id="statusFilter">
                                    <option value="">å…¨éƒ¨</option>
                                    <option value="Pending">å¾…ä»˜æ¬¾</option>
                                    <option value="Paid">å·²ä»˜æ¬¾</option>
                                    <option value="Shipped">å·²å‡ºè²¨</option>
                                    <option value="Cancelled">å–æ¶ˆ</option>
                                    <option value="Failed">ä»˜æ¬¾å¤±æ•—</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-2">
                                <label class="form-label">é…é€</label>
                                <select class="form-select" id="deliveryFilter">
                                    <option value="">å…¨éƒ¨</option>
                                    <option value="address">å®…é…</option>
                                    <option value="cvs_cod">è¶…å•†å–è²¨ä»˜æ¬¾</option>
                                </select>
                            </div>
                            <div class="col-6 col-md-2">
                                <label class="form-label">èµ·æ—¥</label>
                                <input type="date" class="form-control" id="fromDate">
                            </div>
                            <div class="col-6 col-md-2">
                                <label class="form-label">è¿„æ—¥</label>
                                <input type="date" class="form-control" id="toDate">
                            </div>
                            <div class="col-12 col-md-1 d-grid">
                                <button type="button" id="btnSearch" class="btn btn-primary">æŸ¥è©¢</button>
                            </div>
                            <div class="col-12 col-md-1 d-grid">
                                <button type="button" id="btnReset" class="btn btn-outline-secondary">é‡è¨­</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- æ‰¹æ¬¡æ“ä½œ -->
                <div class="d-flex flex-wrap gap-2 mb-2">
                    <div class="form-check me-3">
                        <input class="form-check-input" type="checkbox" value="" id="chkAll">
                        <label class="form-check-label" for="chkAll">å…¨é¸</label>
                    </div>

                    <button class="btn btn-success btn-sm" id="btnBulkMarkPaid" disabled>æ‰¹æ¬¡æ¨™è¨˜å·²ä»˜æ¬¾</button>
                    <button class="btn btn-info btn-sm" id="btnBulkShip" disabled>æ‰¹æ¬¡æ¨™è¨˜å‡ºè²¨</button>
                    <button class="btn btn-outline-danger btn-sm" id="btnBulkCancel" disabled>æ‰¹æ¬¡å–æ¶ˆ</button>
                    <button class="btn btn-outline-secondary btn-sm" id="btnExport">åŒ¯å‡º CSV</button>

                    <div class="ms-auto d-flex align-items-center gap-2">
                        <label for="pageSize" class="form-label m-0 small">æ¯é </label>
                        <select id="pageSize" class="form-select form-select-sm" style="width: auto;">
                            <option>10</option>
                            <option>20</option>
                            <option>50</option>
                            <option>100</option>
                        </select>
                    </div>
                </div>

                <!-- è¡¨æ ¼ -->
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th style="width:36px;">
                                    <input class="form-check-input" type="checkbox" id="chkHeader">
                                </th>
                                <th>è¨‚å–®ç·¨è™Ÿ</th>
                                <th>æœƒå“¡</th>
                                <th>é‡‘é¡</th>
                                <th>ç‹€æ…‹</th>
                                <th>é…é€</th>
                                <th>ä¸‹å–®æ™‚é–“</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="order-table-body">
                            <!-- JS render -->
                        </tbody>
                    </table>
                </div>

                <!-- åˆ†é  -->
                <nav>
                    <ul class="pagination" id="pagination">
                        <!-- JS render -->
                    </ul>
                </nav>
            </main>
        </div>
    </div>

    <!-- ===== Modals ===== -->

    <!-- æ›´æ–°ç‹€æ…‹ -->
    <div class="modal fade" id="statusModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æ›´æ–°ç‹€æ…‹</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2 text-muted">è¨‚å–®ç·¨è™Ÿï¼š<span id="statusOrderId" class="font-mono">â€”</span></div>
                    <div class="mb-3">
                        <label class="form-label">ç‹€æ…‹</label>
                        <select id="statusSelect" class="form-select">
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Shipped">Shipped</option>
                            <option value="Cancelled">Cancelled</option>
                            <option value="Failed">Failed</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">å‚™è¨»ï¼ˆå¯é¸ï¼‰</label>
                        <textarea id="statusNote" class="form-control" rows="3" placeholder="å‚™è¨»èªªæ˜â€¦"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="btnStatusSave">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨™è¨˜å·²ä»˜æ¬¾ -->
    <div class="modal fade" id="markPaidModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æ¨™è¨˜å·²ä»˜æ¬¾</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2 text-muted">è¨‚å–®ç·¨è™Ÿï¼š<span id="markPaidOrderId" class="font-mono">â€”</span></div>
                    <div class="row g-2">
                        <div class="col-6">
                            <label class="form-label">é‡‘æµ</label>
                            <input id="gatewayInput" class="form-control" placeholder="ECPay / Cash / ...">
                        </div>
                        <div class="col-6">
                            <label class="form-label">äº¤æ˜“åºè™Ÿ</label>
                            <input id="tradeNoInput" class="form-control" placeholder="TradeNo / ç¥¨æ“šè™Ÿ">
                        </div>
                        <div class="col-6">
                            <label class="form-label">é‡‘é¡</label>
                            <input id="paidAmountInput" type="number" min="0" class="form-control" placeholder="æ•´æ•¸é‡‘é¡">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" id="btnMarkPaid">æ¨™è¨˜å·²ä»˜æ¬¾</button>
                </div>
            </div>
        </div>
    </div>

    <!-- è¨­å®šç‰©æµ -->
    <div class="modal fade" id="logisticsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">è¨­å®šç‰©æµè³‡è¨Š</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2 text-muted">è¨‚å–®ç·¨è™Ÿï¼š<span id="logisticsOrderId" class="font-mono">â€”</span></div>

                    <!-- æ–°å¢ï¼šé¡¯ç¤ºé…é€/é–€å¸‚è³‡è¨Šçš„å°å€å¡Šï¼ˆç¨‹å¼æœƒå¡«ï¼‰ -->
                    <div id="logisticsMeta" class="small text-muted mb-3"></div>

                    <div class="row g-2">
                        <div class="col-6">
                            <label class="form-label">è¨—é‹å–®è™Ÿ</label>
                            <input id="logisticsIdInput" class="form-control" placeholder="Logistics ID">
                        </div>
                        <div class="col-6">
                            <label class="form-label">è¿½è¹¤ç¢¼</label>
                            <input id="trackingNoInput" class="form-control" placeholder="Tracking No.">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <!-- æ–°å¢ï¼šåªæœ‰å®…é…æ™‚æ‰æœƒé¡¯ç¤º -->
                    <button class="btn btn-outline-primary d-none" id="btnHomeCreate" type="button">
                        å»ºç«‹é»‘è²“å®…é…è¨—é‹å–®
                    </button>
                    <button class="btn btn-info" id="btnLogisticsSave">å„²å­˜ç‰©æµè³‡è¨Š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å–æ¶ˆè¨‚å–® -->
    <div class="modal fade" id="cancelModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">å–æ¶ˆè¨‚å–®</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2 text-muted">è¨‚å–®ç·¨è™Ÿï¼š<span id="cancelOrderId" class="font-mono">â€”</span></div>
                    <label class="form-label">åŸå› ï¼ˆå¯é¸ï¼‰</label>
                    <textarea id="cancelReasonInput" class="form-control" rows="3"
                        placeholder="ä¾‹å¦‚ï¼šè²·å®¶è¦æ±‚ã€ä»˜æ¬¾é€¾æœŸâ€¦"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline-danger" id="btnCancelSave">ç¢ºèªå–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Toasts / Loading ===== -->
    <div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer"></div>

    <div class="loading-backdrop" id="loading">
        <div class="spinner-border text-primary" role="status" aria-label="Loading"></div>
    </div>

    <!-- Bootstrap bundle (å« Modal/Dropdown/Toast) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- ä½ çš„é é¢è¡Œç‚º -->
    <script src="js/adminOrders.js"></script>
</body>

</html>