<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wepet 寵物資訊平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="chatroom.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script th:src="@{/memFunction.js}"></script>
    <link rel="stylesheet" th:href="@{/styles.css}">
</head>

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
    <div class="container-fluid">
        <!-- LOGO -->
        <a class="navbar-brand" href="/index">
            <img src="../pet-icon.png" width="36" height="36" class="d-inline-block align-top" alt="logo">
            寵物資訊平台
        </a>

        <!-- 手機切換按鈕 -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 導覽列連結 -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center w-100">

                <!-- 左側按鈕 -->
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link btn btn-login m-1" href="#">尋找領養</a></li>
                    <li class="nav-item"><a class="nav-link btn btn-login m-1" href="#">尋找任務</a></li>
                    <li class="nav-item"><a class="nav-link btn btn-login m-1" href="#">寵物商城</a></li>
                </ul>

                <!-- 右側按鈕 -->
                <div class=" position-fixed end-0 m-4 ">
                    <button id="chat-toggle" class="btn btn-material">
                        <span class="material-icons">chat_bubble_outline</span>
                    </button>
                    <button class="btn btn-material">
                        <span class="material-icons">shopping_cart</span>
                    </button>
                    <div class="dropdown d-inline">
                        <button class="btn btn-material dropdown-toggle" type="button" id="accountDropdown"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="material-icons">account_circle</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
                            <li><a class="dropdown-item" href="/auth/profileUpdate">修改資料</a></li>
                            <li>
                                <form action="/auth/logout" method="post" style="margin: 0;">
                                    <button type="submit" class="dropdown-item" style="border: none; background: none; width: 100%; text-align: left;">登出</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="container">
    <!-- 主要內容區域 -->
    <!-- 我的資料頁面 -->
    <div id="profile" class="content-section">
        <h1 class="page-title">我的資料</h1>

        <div class="verification-options">
            <button class="verification-btn active" onclick="setVerificationMethod('update')">資料異動</button>
            <button class="verification-btn" onclick="setVerificationMethod('password')">變更密碼</button>
            <button class="verification-btn" onclick="setVerificationMethod('deleteAccount')">刪除帳號</button>
        </div>

        <div class="message success" id="successMessage" th:if="${message}" th:text="${message}"></div>
        <div class="message error" id="errorMessage"></div>

        <div id="profileUpdate" class="verification-section" style="display: block;">
            <form action="/auth/profileUpdate" method="post">
                <input type="hidden" name="user_id" th:value="${user.user_id}">
                <div class="form-group">
                    <label class="form-label">姓名</label>
                    <input type="text" class="form-input" name="username" placeholder="請輸入姓名" th:value="${user.username}">

                    <label class="form-label">手機號碼</label>
                    <input type="tel" class="form-input" name="phonenumber" placeholder="請輸入手機號碼" th:value="${user.phonenumber}" id="phoneInput">

                    <label for="gender" class="form-label">性別</label>
                    <select id="gender" name="gender">
                        <option value="">請選擇</option>
                        <option value="M" th:selected="${user.gender == 'M'}">男</option>
                        <option value="F" th:selected="${user.gender == 'F'}">女</option>
                        <option value="other" th:selected="${user.gender == 'other'}">其他</option>
                    </select>

                    <label class="form-label">電子郵件</label>
                    <input type="email" class="form-input" name="accountemail" placeholder="請輸入電子郵件" th:value="${user.accountemail}">

                    <label for="city" class="form-label">縣市：</label>
                    <select id="city" name="city" onchange="updateDistricts()">
                        <option value="">請選擇縣市</option>
                    </select>

                    <label for="district" class="form-label">鄉鎮市區：</label>
                    <select id="district" name="district">
                        <option value="">請選擇鄉鎮市區</option>
                    </select>

                    <label for="experience" class="form-label">飼養經驗</label>
                    <select id="experience" name="experience">
                        <option value="Y" th:selected="${user.experience == 'Y'}">有</option>
                        <option value="N" th:selected="${user.experience == 'N'}">無</option>
                    </select>

                    <label for="daily" class="form-label">生活作息(大多時間)</label>
                    <select id="daily" name="daily">
                        <option value="早起型（6:00-7:00起床）" th:selected="${user.daily == '早起型（6:00-7:00起床）'}">早起型（6:00-7:00起床）</option>
                        <option value="正常作息（7:00-9:00起床）" th:selected="${user.daily == '正常作息（7:00-9:00起床）'}">正常作息（7:00-9:00起床）</option>
                        <option value="晚起型（9:00以後起床）" th:selected="${user.daily == '晚起型（9:00以後起床）'}">晚起型（9:00以後起床）</option>
                        <option value="夜貓子（經常熬夜）" th:selected="${user.daily == '夜貓子（經常熬夜）'}">夜貓子（經常熬夜）</option>
                    </select>

                    <div class="form-group full-width">
                        <label for="pet" class="form-label">您偏好飼養的寵物類型（可多選）：</label>
                        <div class="checkbox-option">
                            <input type="checkbox" id="dog" name="pet" value="狗">
                            <label for="dog">狗狗</label>
                            <input type="checkbox" id="cat" name="pet" value="貓">
                            <label for="cat">貓咪</label>
                        </div>

                        <label for="pet_activities" class="form-label">您偏好飼養的寵物個性（可多選）：</label>
                        <div class="checkbox-option">
                            <input type="checkbox" id="cheerful" name="pet_activities" value="活潑">
                            <label for="cheerful">個性活潑型</label>

                            <input type="checkbox" id="quiet" name="pet_activities" value="安靜">
                            <label for="quiet">個性安靜型</label>

                            <input type="checkbox" id="fear" name="pet_activities" value="怕生">
                            <label for="fear">接受怕生的</label>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">確認</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">重設</button>
                </div>
            </form>
        </div>

        <div id="deleteAccountPage" class="verification-section" style="display: none;">
            <div class="form-group">
                <p class="form-label">您確定要刪除帳號嗎？</p>
                <button type="button" class="btn btn-outline">確認刪除帳號</button>
            </div>
        </div>

        <div id="passwordChange" class="verification-section" style="display: none;">
            <div class="form-group">
                <label class="form-label">目前密碼</label>
                <input type="password" class="form-input" placeholder="請輸入目前密碼">

                <label class="form-label">新密碼</label>
                <input type="password" class="form-input" placeholder="請輸入新密碼">

                <label class="form-label">確認新密碼</label>
                <input type="password" class="form-input" placeholder="請再次輸入新密碼">
            </div>
            <div class="button-group">
                <button type="submit" class="btn btn-primary">確認</button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">重設</button>
            </div>
        </div>
    </div>
</div>

<script>
    // 台灣部分行政區資料（簡化示範，可擴充）
    const taiwanRegions = {
        '台北市': [
            '中正區', '大同區', '中山區', '萬華區', '信義區', '松山區', '大安區', '南港區', '北投區', '內湖區', '士林區', '文山區'
        ],
        '新北市': [
            '板橋區', '新莊區', '泰山區', '林口區', '淡水區', '金山區', '八里區', '萬里區', '石門區', '三芝區', '瑞芳區', '汐止區', '平溪區', '貢寮區', '雙溪區', '深坑區', '石碇區', '新店區', '坪林區', '烏來區', '中和區', '永和區', '土城區', '三峽區', '樹林區', '鶯歌區', '三重區', '蘆洲區', '五股區'
        ],
        '台中市': [
            '中區', '東區', '南區', '西區', '北區', '北屯區', '西屯區', '南屯區', '太平區', '大里區', '霧峰區', '烏日區', '豐原區', '后里區', '東勢區', '石岡區', '新社區', '和平區', '神岡區', '潭子區', '大雅區', '大肚區', '龍井區', '沙鹿區', '梧棲區', '清水區', '大甲區', '外埔區', '大安區'
        ]
    };

    const citySelect = document.getElementById("city");
    const districtSelect = document.getElementById("district");

    // 初始化縣市下拉選單
    for (let county in taiwanRegions) {
        const option = document.createElement("option");
        option.value = county;
        option.textContent = county;
        citySelect.appendChild(option);
    }

    // 根據縣市更新鄉鎮市區
    function updateDistricts() {
        const selectedCounty = citySelect.value;
        districtSelect.innerHTML = '<option value="">請選擇鄉鎮市區</option>';

        if (taiwanRegions[selectedCounty]) {
            taiwanRegions[selectedCounty].forEach(district => {
                const option = document.createElement("option");
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }
    }

    // 設定驗證方法
    function setVerificationMethod(method) {
        // 隱藏所有區塊
        document.getElementById('profileUpdate').style.display = 'none';
        document.getElementById('passwordChange').style.display = 'none';
        document.getElementById('deleteAccountPage').style.display = 'none';

        // 移除所有按鈕的active class
        const buttons = document.querySelectorAll('.verification-btn');
        buttons.forEach(btn => btn.classList.remove('active'));

        // 顯示對應區塊並標記按鈕為active
        if (method === 'update') {
            document.getElementById('profileUpdate').style.display = 'block';
            document.querySelector('button[onclick="setVerificationMethod(\'update\')"]').classList.add('active');
        } else if (method === 'password') {
            document.getElementById('passwordChange').style.display = 'block';
            document.querySelector('button[onclick="setVerificationMethod(\'password\')"]').classList.add('active');
        } else if (method === 'deleteAccount') {
            document.getElementById('deleteAccountPage').style.display = 'block';
            document.querySelector('button[onclick="setVerificationMethod(\'deleteAccount\')"]').classList.add('active');
        }
    }

    function resetForm() {
        // 重設表單邏輯
        const activeSection = document.querySelector('.verification-section[style*="block"]');
        if (activeSection) {
            const form = activeSection.querySelector('form');
            if (form) {
                form.reset();
            }
        }
    }

    // 頁面載入時設定已選擇的值
    document.addEventListener('DOMContentLoaded', function() {
        // 設定縣市
        const userCity = '[[${user.city}]]';
        if (userCity && userCity !== 'null') {
            citySelect.value = userCity;
            updateDistricts();

            // 設定區域
            const userDistrict = '[[${user.district}]]';
            if (userDistrict && userDistrict !== 'null') {
                setTimeout(() => {
                    districtSelect.value = userDistrict;
                }, 100);
            }
        }

        // 設定寵物偏好的勾選狀態
        const userPets = '[[${user.pet}]]';
        if (userPets && userPets !== 'null') {
            const pets = userPets.split(',');
            pets.forEach(pet => {
                const checkbox = document.querySelector(`input[name="pet"][value="${pet.trim()}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }

        // 設定寵物個性偏好的勾選狀態
        const userPetActivities = '[[${user.pet_activities}]]';
        if (userPetActivities && userPetActivities !== 'null') {
            const activities = userPetActivities.split(',');
            activities.forEach(activity => {
                const checkbox = document.querySelector(`input[name="pet_activities"][value="${activity.trim()}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }
    });
</script>
</body>
</html>