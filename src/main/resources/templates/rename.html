<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wepet 寵物資訊平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" th:href="@{../styles.css}" />
    <link rel="stylesheet" href="chatroom.css" />
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
</head>

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
    <div class="container-fluid">
        <!-- LOGO -->
        <a class="navbar-brand" th:href="@{/index}">
            <img src="../pet-icon.png" width="36" height="36" class="d-inline-block align-top" alt="logo" />
            寵物資訊平台
        </a>
        <!-- 手機切換按鈕 -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 導覽列連結 -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <div
                    class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center w-100">
                <!-- 左側按鈕 -->
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link btn btn-login m-1" href="#">尋找領養</a></li>
                    <li class="nav-item"><a class="nav-link btn btn-login m-1" href="#">尋找任務</a></li>
                    <li class="nav-item"><a class="nav-link btn btn-login m-1" href="#">寵物商城</a></li>
                </ul>
                <!-- 右側按鈕 -->
                <div class="position-fixed end-0 m-4">
                    <button id="chat-toggle" class="btn btn-material">
                        <span class="material-icons">chat_bubble_outline</span>
                    </button>
                    <button class="btn btn-material">
                        <span class="material-icons">shopping_cart</span>
                    </button>
                    <div class="dropdown d-inline">
                        <button class="btn btn-material dropdown-toggle" type="button" id="accountDropdown"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="material-icons">account_circle</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
                            <li><a class="dropdown-item" th:href="@{/rename}" >修改資料</a></li>
                            <li>  <a class="dropdown-item" sec:authorize="hasAuthority('ROLE_MANAGER')" th:href="@{/managersIndex}">管理按鈕</a></li>
                            <li>   <a class="dropdown-item" sec:authorize="hasAnyAuthority('ROLE_MANAGER', 'ROLE_USER')" onclick="location.href='/logout';" >離開按鈕</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 80px;">
    <!-- 我的資料頁面 -->
    <div id="profile" class="content-section">
        <h1 class="page-title">我的資料</h1>

        <div class="verification-options">
            <button class="verification-btn" onclick="setVerificationMethod('password', event)">密碼變更</button>
            <button class="verification-btn" onclick="setVerificationMethod('update', event)">資料更新</button>
            <button class="verification-btn" onclick="setVerificationMethod('deleteAccount', event)">刪除帳號</button>

        </div>

        <div class="message success" id="successMessage" th:if="${successMessage}" th:text="${successMessage}"></div>
        <div class="message error" id="errorMessage" th:if="${errorMessage}" th:text="${errorMessage}"></div>

        <!-- 資料異動表單 -->
        <form th:action="@{/rename}" th:object="${user}" method="post" id="profileForm">

<!-- 改密碼的提示訊息-->
            <p th:if="${passwordMessage}" th:text="${passwordMessage}"
               th:classappend="${passwordMessage.contains('成功')} ? 'text-success' : 'text-danger'"></p>

            <div id="profileUpdate" class="verification-section" style="display: block;">
                <div class="form-group mb-3">
                    <label for="username" class="form-label">姓名</label>
                    <input type="text" th:field="*{username}" class="form-control" id="username" placeholder="請輸入姓名" />
                </div>

                <div class="form-group mb-3">
                    <label for="gender" class="form-label">性別</label>
                    <select th:field="*{gender}" id="gender" class="form-select">
                        <option value="" th:text="'請選擇'" th:selected="*{gender} == null or *{gender} == ''"></option>
                        <option value="男" th:selected="*{gender} == '男'">男</option>
                        <option value="女" th:selected="*{gender} == '女'">女</option>
                        <option value="其他" th:selected="*{gender} == '其他'">其他</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="phonenumber" class="form-label">手機號碼</label>
                    <input type="text" th:field="*{phonenumber}" class="form-control" id="phonenumber" placeholder="請輸入手機號碼" />
                </div>

                <div class="form-group mb-3">
                    <label for="city" class="form-label">縣市</label>
                    <select th:field="*{city}" id="city" class="form-select" onchange="updateDistricts()">
                        <option value="" th:text="'請選擇縣市'" th:selected="*{city} == null or *{city} == ''"></option>
                        <!-- 這裡可以用 JavaScript 動態填充縣市選項 -->
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="district" class="form-label">鄉鎮市區</label>
                    <select th:field="*{district}" id="district" class="form-select">
                        <option value="" th:text="'請選擇鄉鎮市區'" th:selected="*{district} == null or *{district} == ''"></option>
                        <!-- JavaScript 動態填充鄉鎮市區選項 -->
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="experience" class="form-label">飼養經驗</label>
                    <select th:field="*{experience}" id="experience" class="form-select">
                        <option value="有" th:selected="*{experience} == '有'">有</option>
                        <option value="無" th:selected="*{experience} == '無'">無</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="daily" class="form-label">生活作息(大多時間)</label>
                    <select th:field="*{daily}" id="daily" class="form-select">
                        <option value="早起型（6:00-7:00起床）" th:selected="*{daily} == '早起型（6:00-7:00起床）'">早起型（6:00-7:00起床）</option>
                        <option value="正常作息（7:00-9:00起床）" th:selected="*{daily} == '正常作息（7:00-9:00起床）'">正常作息（7:00-9:00起床）</option>
                        <option value="晚起型（9:00以後起床）" th:selected="*{daily} == '晚起型（9:00以後起床）'">晚起型（9:00以後起床）</option>
                        <option value="夜貓子（經常熬夜）" th:selected="*{daily} == '夜貓子（經常熬夜）'">夜貓子（經常熬夜）</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label class="form-label">您偏好飼養的寵物類型（可多選）</label>
                    <div>
                        <input type="checkbox" id="dog" th:field="*{petList}" value="狗" />
                        <label for="dog">狗狗</label>

                        <input type="checkbox" id="cat" th:field="*{petList}" value="貓" />
                        <label for="cat">貓咪</label>
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label class="form-label">您偏好飼養的寵物個性（可多選）</label>
                    <div>
                        <input type="checkbox" id="cheerful" th:field="*{petActivitiesList}" value="活潑" />
                        <label for="cheerful">個性活潑型</label>

                        <input type="checkbox" id="quiet" th:field="*{petActivitiesList}" value="安靜" />
                        <label for="quiet">個性安靜型</label>

                        <input type="checkbox" id="fear" th:field="*{petActivitiesList}" value="怕生" />
                        <label for="fear">接受怕生的</label>
                    </div>
                </div>

                <div class="button-group mb-3">
                    <button type="submit" class="btn btn-primary">確認</button>
                    <button type="reset" class="btn btn-secondary" onclick="resetForm()">重設</button>
                </div>
            </div>
        </form>

<!--        刪除帳號-->

        <form class="profile-form">
            <div id="deleteAccountPage" class="verification-section">
                <div class="form-group">
                    <p class="form-label">您確定要刪除帳號嗎？</p>
                    <button type="button" class="btn btn-outline">確認刪除帳號</button>
                </div>
            </div>
        </form>

        <!--修改密碼-->
        <form th:action="@{/rename/change-password}" method="post">
<!--            <p th:if="${passwordMessage}" th:text="${passwordMessage}"></p>-->
            <div id="passwordChange" class="verification-section" style="display:none;">
                <div class="form-group">
                    <label>目前密碼</label>
                    <input type="password" name="currentPassword" class="form-control" required>

                    <label>新密碼</label>
                    <input type="password" name="newPassword" class="form-control" required>

                    <label>確認新密碼</label>
                    <input type="password" name="confirmPassword" class="form-control" required>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary">確認</button>
                    <button type="reset" class="btn btn-secondary">重設</button>
                </div>
            </div>
        </form>


    </div>

</div>

<script th:src="@{/memFunction.js}"></script>

</body>

</html>
